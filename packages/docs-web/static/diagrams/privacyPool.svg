<svg width="900" height="700" viewBox="0 0 900 700" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3.5, 0 7" fill="black"/>
    </marker>
    <marker id="dashed-arrow" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3.5, 0 7" fill="blue"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="450" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="black">Privacy Pool Flow - Deposit & Withdrawal</text>
  
  <!-- Actors/Components -->
  <!-- User -->
  <rect x="50" y="50" width="80" height="40" fill="#e6e6fa" stroke="black" stroke-width="2" rx="5"/>
  <text x="90" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">User</text>
  
  <!-- ERC20 -->
  <rect x="180" y="50" width="80" height="40" fill="#ffe4e1" stroke="black" stroke-width="2" rx="5"/>
  <text x="220" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">ERC20</text>
  
  <!-- Privacy Pool -->
  <rect x="310" y="50" width="100" height="40" fill="#e6ffe6" stroke="black" stroke-width="2" rx="5"/>
  <text x="360" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Privacy Pool</text>
  
  <!-- EncryptedERC -->
  <rect x="460" y="50" width="100" height="40" fill="#fff0e6" stroke="black" stroke-width="2" rx="5"/>
  <text x="510" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">EncryptedERC</text>
  
  <!-- Relayer -->
  <rect x="610" y="50" width="80" height="40" fill="#e6f3ff" stroke="black" stroke-width="2" rx="5"/>
  <text x="650" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">Relayer</text>
  
  <!-- Vertical lifelines -->
  <line x1="90" y1="90" x2="90" y2="650" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="220" y1="90" x2="220" y2="650" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="360" y1="90" x2="360" y2="650" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="510" y1="90" x2="510" y2="650" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="650" y1="90" x2="650" y2="650" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- User state -->
  <rect x="30" y="110" width="120" height="30" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="90" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Has: ERC20 tokens, secret</text>
  
  <!-- DEPOSIT FLOW -->
  <!-- 1. Approve -->
  <line x1="90" y1="160" x2="220" y2="160" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="155" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">approve(amount)</text>
  
  <!-- 2. Prepare deposit -->
  <rect x="80" y="180" width="120" height="40" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="140" y="195" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Generate:</text>
  <text x="140" y="210" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">commitment, nullifier</text>
  
  <!-- 3. Deposit -->
  <line x1="90" y1="240" x2="360" y2="240" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="225" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">deposit(commitment, amount)</text>
  
  <!-- 4. Transfer tokens -->
  <line x1="360" y1="260" x2="220" y2="260" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="290" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">transferFrom(user, pool, amount)</text>
  
  <!-- 5. Mint eERC -->
  <line x1="360" y1="280" x2="510" y2="280" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="435" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">mint(user, encryptedAmount)</text>
  
  <!-- 6. Update state -->
  <rect x="300" y="300" width="120" height="40" fill="#e6ffe6" stroke="black" stroke-width="1"/>
  <text x="360" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Update merkle tree</text>
  <text x="360" y="330" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Store commitment</text>
  
  <!-- 7. Emit event -->
  <line x1="360" y1="360" x2="90" y2="360" stroke="blue" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#dashed-arrow)"/>
  <text x="225" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="blue">DepositComplete event</text>
  
  <!-- User has eERC -->
  <rect x="30" y="380" width="120" height="30" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="90" y="400" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Has: eERC tokens (private)</text>
  
  <!-- Separator -->
  <line x1="20" y1="430" x2="880" y2="430" stroke="gray" stroke-width="3"/>
  <text x="450" y="425" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="gray">WITHDRAWAL FLOW (Optional)</text>
  
  <!-- WITHDRAWAL FLOW -->
  <!-- 1. Prepare withdrawal -->
  <rect x="20" y="450" width="140" height="40" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="90" y="465" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Generate:</text>
  <text x="90" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">ZK proof, nullifier</text>
  
  <!-- 2. Submit to relayer -->
  <line x1="90" y1="510" x2="650" y2="510" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="370" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">withdraw(proof, nullifier, recipient)</text>
  
  <!-- 3. Verify proof -->
  <rect x="590" y="530" width="120" height="30" fill="#e6f3ff" stroke="black" stroke-width="1"/>
  <text x="650" y="550" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Verify ZK proof locally</text>
  
  <!-- 4. Submit to pool -->
  <line x1="650" y1="580" x2="360" y2="580" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="505" y="570" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">relayedWithdraw(proof)</text>
  
  <!-- 5. Verify and process -->
  <rect x="300" y="600" width="120" height="50" fill="#e6ffe6" stroke="black" stroke-width="1"/>
  <text x="360" y="615" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Verify proof</text>
  <text x="360" y="630" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Check nullifier</text>
  <text x="360" y="645" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Update state</text>
  
  <!-- 6. Burn eERC -->
  <line x1="360" y1="670" x2="510" y2="670" stroke="red" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="435" y="660" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="red">burn(encryptedAmount)</text>
  
  <!-- 7. Transfer ERC20 -->
  <line x1="360" y1="690" x2="220" y2="690" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="290" y="680" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">transfer(recipient, amount)</text>
  
  <!-- Final flow labels -->
  <text x="20" y="180" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="green">DEPOSIT</text>
  <text x="20" y="470" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="orange">WITHDRAW</text>
  
  <!-- Legend -->
  <rect x="730" y="100" width="150" height="100" fill="white" stroke="black" stroke-width="1"/>
  <text x="805" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Legend</text>
  <line x1="740" y1="130" x2="770" y2="130" stroke="black" stroke-width="2"/>
  <text x="780" y="135" font-family="Arial, sans-serif" font-size="9">Required call</text>
  <line x1="740" y1="145" x2="770" y2="145" stroke="blue" stroke-width="2" stroke-dasharray="3,3"/>
  <text x="780" y="150" font-family="Arial, sans-serif" font-size="9">Event/Response</text>
  <line x1="740" y1="160" x2="770" y2="160" stroke="red" stroke-width="2"/>
  <text x="780" y="165" font-family="Arial, sans-serif" font-size="9">Internal call</text>
  <rect x="740" y="175" width="30" height="15" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="780" y="185" font-family="Arial, sans-serif" font-size="9">Process</text>
</svg>