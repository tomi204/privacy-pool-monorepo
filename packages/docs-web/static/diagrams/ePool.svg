<svg width="1000" height="750" viewBox="0 0 1000 750" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3.5, 0 7" fill="black"/>
    </marker>
    <marker id="dashed-arrow" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3.5, 0 7" fill="blue"/>
    </marker>
    <marker id="red-arrow" markerWidth="10" markerHeight="7" 
     refX="9" refY="3.5" orient="auto" markerUnits="strokeWidth">
      <polygon points="0 0, 10 3.5, 0 7" fill="red"/>
    </marker>
  </defs>
  
  <!-- Title -->
  <text x="500" y="25" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="black">Complete Voucher Swap Process</text>
  
  <!-- Actors/Components -->
  <!-- User A -->
  <rect x="30" y="50" width="80" height="40" fill="#e6e6fa" stroke="black" stroke-width="2" rx="5"/>
  <text x="70" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">User A</text>
  <text x="70" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">(Token X)</text>
  
  <!-- User B -->
  <rect x="130" y="50" width="80" height="40" fill="#e6e6fa" stroke="black" stroke-width="2" rx="5"/>
  <text x="170" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">User B</text>
  <text x="170" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">(Token Y)</text>
  
  <!-- EncryptedERC X -->
  <rect x="230" y="50" width="100" height="40" fill="#fff0e6" stroke="black" stroke-width="2" rx="5"/>
  <text x="280" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">eERC X</text>
  <text x="280" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">Contract</text>
  
  <!-- EncryptedERC Y -->
  <rect x="350" y="50" width="100" height="40" fill="#fff0e6" stroke="black" stroke-width="2" rx="5"/>
  <text x="400" y="70" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">eERC Y</text>
  <text x="400" y="82" text-anchor="middle" font-family="Arial, sans-serif" font-size="8">Contract</text>
  
  <!-- E-Pool -->
  <rect x="470" y="50" width="100" height="40" fill="#ffe6f0" stroke="black" stroke-width="2" rx="5"/>
  <text x="520" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">E-Pool</text>
  
  <!-- Relayer -->
  <rect x="590" y="50" width="100" height="40" fill="#e6f3ff" stroke="black" stroke-width="2" rx="5"/>
  <text x="640" y="75" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold">E-Pool Relayer</text>
  
  <!-- Vertical lifelines -->
  <line x1="70" y1="90" x2="70" y2="700" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="210" y1="90" x2="210" y2="700" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="280" y1="90" x2="280" y2="700" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="400" y1="90" x2="400" y2="700" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="520" y1="90" x2="520" y2="700" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  <line x1="640" y1="90" x2="640" y2="700" stroke="black" stroke-width="2" stroke-dasharray="5,5"/>
  
  <!-- User states -->
  <rect x="10" y="110" width="120" height="40" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="70" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Has: eERC X tokens</text>

  <rect x="150" y="110" width="120" height="40" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="210" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Has: eERC Y tokens</text>
  
  <!-- STEP 1: Create Vouchers -->
  <text x="20" y="170" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="green">STEP 1: Create Vouchers</text>

  <!-- User A creates voucher -->
  <rect x="10" y="180" width="120" height="40" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="70" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Generate ZK proof</text>

  <line x1="70" y1="240" x2="280" y2="240" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="175" y="230" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">burnToVoucher(amountX, proof)</text>

  <!-- User B creates voucher (parallel) -->
  <rect x="150" y="180" width="120" height="40" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="210" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Generate ZK proof</text>

  <line x1="210" y1="260" x2="400" y2="260" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="305" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">burnToVoucher(amountY, proof)</text>
  
  <!-- Voucher creation responses -->
  <line x1="280" y1="280" x2="70" y2="280" stroke="blue" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#dashed-arrow)"/>
  <text x="175" y="270" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="blue">VoucherX created</text>

  <line x1="400" y1="300" x2="210" y2="300" stroke="blue" stroke-width="2" stroke-dasharray="3,3" marker-end="url(#dashed-arrow)"/>
  <text x="305" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="blue">VoucherY created</text>
  
  <!-- STEP 2: Deposit to E-Pool -->
  <text x="20" y="340" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="green">STEP 2: Deposit Vouchers to E-Pool</text>

  <line x1="70" y1="360" x2="520" y2="360" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="295" y="350" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">depositVoucher(voucherX) + AVAX fees</text>

  <line x1="210" y1="380" x2="520" y2="380" stroke="black" stroke-width="2" marker-end="url(#arrowhead)"/>
  <text x="365" y="370" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">depositVoucher(voucherY) + AVAX fees</text>
  
  <!-- E-Pool processes -->
  <rect x="460" y="400" width="120" height="50" fill="#ffe6f0" stroke="black" stroke-width="1"/>
  <text x="520" y="415" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Store vouchers</text>
  <text x="520" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Mark available for swap</text>

  <!-- STEP 3: Relayer Verification -->
  <text x="20" y="470" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="orange">STEP 3: Relayer Verification</text>

  <line x1="520" y1="490" x2="640" y2="490" stroke="red" stroke-width="2" marker-end="url(#red-arrow)"/>
  <text x="580" y="480" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="red">notify new vouchers</text>

  <rect x="580" y="510" width="120" height="60" fill="#e6f3ff" stroke="black" stroke-width="1"/>
  <text x="640" y="525" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Check market rates</text>
  <text x="640" y="540" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Verify amounts</text>
  <text x="640" y="555" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">Match compatible pairs</text>

  <!-- STEP 4: Execute Swap -->
  <text x="20" y="590" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="red">STEP 4: Execute Atomic Swap</text>

  <line x1="640" y1="610" x2="520" y2="610" stroke="red" stroke-width="2" marker-end="url(#red-arrow)"/>
  <text x="580" y="600" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="red">swapVouchers(voucherX, voucherY)</text>
  
  <!-- Final results -->
  <line x1="520" y1="630" x2="70" y2="630" stroke="blue" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#dashed-arrow)"/>
  <text x="295" y="620" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="blue">VoucherY → User A</text>

  <line x1="520" y1="650" x2="210" y2="650" stroke="blue" stroke-width="3" stroke-dasharray="5,5" marker-end="url(#dashed-arrow)"/>
  <text x="365" y="640" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="blue">VoucherX → User B</text>
  
  <!-- Final states -->
  <rect x="720" y="150" width="120" height="60" fill="#f0f0f0" stroke="gray" stroke-width="1" stroke-dasharray="2,2"/>
  <text x="780" y="170" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold">Final Result:</text>
  <text x="780" y="185" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">User A has VoucherY</text>
  <text x="780" y="197" text-anchor="middle" font-family="Arial, sans-serif" font-size="9">User B has VoucherX</text>

  <!-- Legend -->
  <rect x="720" y="240" width="150" height="120" fill="white" stroke="black" stroke-width="1"/>
  <text x="795" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold">Legend</text>
  <line x1="730" y1="275" x2="760" y2="275" stroke="black" stroke-width="2"/>
  <text x="770" y="280" font-family="Arial, sans-serif" font-size="8">User action</text>
  <line x1="730" y1="290" x2="760" y2="290" stroke="blue" stroke-width="2" stroke-dasharray="3,3"/>
  <text x="770" y="295" font-family="Arial, sans-serif" font-size="8">Response/Event</text>
  <line x1="730" y1="305" x2="760" y2="305" stroke="red" stroke-width="2"/>
  <text x="770" y="310" font-family="Arial, sans-serif" font-size="8">Relayer action</text>
  <line x1="730" y1="320" x2="760" y2="320" stroke="blue" stroke-width="3" stroke-dasharray="5,5"/>
  <text x="770" y="325" font-family="Arial, sans-serif" font-size="8">Final swap</text>
  <rect x="730" y="330" width="20" height="10" fill="#ffffcc" stroke="black" stroke-width="1"/>
  <text x="760" y="337" font-family="Arial, sans-serif" font-size="8">Process</text>
</svg>